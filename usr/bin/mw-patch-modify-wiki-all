#!/usr/bin/env bash

set -euEo pipefail

# shellcheck source=../share/mediawiki-shell/common
source /usr/share/mediawiki-shell/common

log info "START"

usage(){
  printf '%s\n' "Usage: ${0##*/} WIKI
Example:
  ${0##*/} https://www.kicksecure.com/w" >&2
  exit 1
}

if [[ -z "${1-}" || "${1-}" =~ (-h|--help) ]]; then
  usage
fi

wiki_url="$1"

# shellcheck source=../share/mediawiki-shell/wiki-config
WIKI_URL="$wiki_url" source /usr/share/mediawiki-shell/wiki-config

log info "TMPFOLDER: $TMPFOLDER"
log info "wiki_url : $wiki_url"
log info "WIKI_API : $WIKI_API"

mw-process-all-pages "${wiki_url}" "${0##*/}"
