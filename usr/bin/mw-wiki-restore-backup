#!/usr/bin/env bash

set -euEo pipefail

# shellcheck source=../share/mediawiki-shell/common
source /usr/share/mediawiki-shell/common

log info "START"

usage(){
  printf '%s\n' "Usage: ${0##*/} WIKI OUTPUT_DIR
Example:
  ${0##*/} 'https://www.kicksecure.com/w'
  ${0##*/} 'https://www.kicksecure.com/w' ~/mediawiki-shell/kicksecure-wiki-backup" >&2
  exit 1
}

if [[ -z "${2-}" || "${1-}" =~ (-h|--help) ]]; then
  usage
fi

wiki_url="$1"
output_dir="$2"

allpages_file="${TMPFOLDER}/allpages.txt"
safe-rm -f -- "$allpages_file"

log info "TMPFOLDER : $TMPFOLDER"
log info "output_dir: $output_dir"
log info "wiki      : $wiki_url"

mkdir -p -- "$output_dir"

if ! test -d "$output_dir"; then
  die 1 "output_dir '$output_dir' does not exist! Run?: mkdir --parents -- '$output_dir'"
fi

if ! test -w "$output_dir"; then
  die 1 "output_dir '$output_dir' unwriteable! Run?: chown --recursive -- '$USER:$USER' '$output_dir'"
fi

mw-login-test "$wiki_url"
## TODO
die 1 "UNFINISHED SCRIPT!"

## Remove trailing spaces.
# shellcheck disable=SC2001,SC2317
wiki_page_content="$(sed 's/[[:space:]]*$//' <<<"$wiki_page_content")"
